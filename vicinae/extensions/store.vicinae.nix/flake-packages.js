"use strict";var I=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var F=Object.prototype.hasOwnProperty;var A=(e,i)=>{for(var c in i)I(e,c,{get:i[c],enumerable:!0})},U=(e,i,c,s)=>{if(i&&typeof i=="object"||typeof i=="function")for(let n of T(i))!F.call(e,n)&&n!==c&&I(e,n,{get:()=>i[n],enumerable:!(s=v(i,n))||s.enumerable});return e};var z=e=>U(I({},"__esModule",{value:!0}),e);var j={};A(j,{default:()=>O});module.exports=z(j);var L=require("@vicinae/api");var D=require("@vicinae/api"),b=(0,D.getPreferenceValues)(),E={"User-Agent":"Mozilla/5.0 (X11; Linux x86_64; rv:138.0) Gecko/20100101 Firefox/138.0",Origin:"https://search.nixos.org/",Accept:"application/json","Content-Type":"application/json",Authorization:`Basic ${b.authToken}`};function H(e,i){return{from:0,size:50,sort:[{_score:"desc",package_attr_name:"desc",package_pversion:"desc"}],aggs:{package_attr_set:{terms:{field:"package_attr_set",size:20}},package_license_set:{terms:{field:"package_license_set",size:20}},package_maintainers_set:{terms:{field:"package_maintainers_set",size:20}},package_teams_set:{terms:{field:"package_teams_set",size:20}},package_platforms:{terms:{field:"package_platforms",size:20}},all:{global:{},aggregations:{package_attr_set:{terms:{field:"package_attr_set",size:20}},package_license_set:{terms:{field:"package_license_set",size:20}},package_maintainers_set:{terms:{field:"package_maintainers_set",size:20}},package_teams_set:{terms:{field:"package_teams_set",size:20}},package_platforms:{terms:{field:"package_platforms",size:20}}}}},query:{bool:{filter:[{term:{type:{value:"package",_name:"filter_packages"}}},{bool:{must:[{bool:{should:[]}},{bool:{should:[]}},{bool:{should:[]}},{bool:{should:[]}},{bool:{should:[]}}]}}],must_not:[],must:[{dis_max:{tie_breaker:.7,queries:[{multi_match:{type:"cross_fields",query:e,analyzer:"whitespace",auto_generate_synonyms_phrase_query:!1,operator:"and",_name:`multi_match_${e}`,fields:["package_attr_name^9","package_attr_name.*^5.3999999999999995","package_programs^9","package_programs.*^5.3999999999999995","package_pname^6","package_pname.*^3.5999999999999996","package_description^1.3","package_description.*^0.78","package_longDescription^1","package_longDescription.*^0.6","flake_name^0.5","flake_name.*^0.3"]}},{wildcard:{package_attr_name:{value:`*${e}*`,case_insensitive:!0}}}]}}]}},_source:i,track_total_hits:!0}}function S(e){return e?e.replace(/<[^>]*>/g,"").replace(/^\n+/,"").replace(/\n+$/,"").trim():""}async function P(e){let i=b.searchUrl.replace("latest-44-nixos-unstable","latest-44-group-manual"),c=H(e,["type","flake_description","flake_resolved","flake_name","revision","flake_source","package_attr_name","package_attr_set","package_pname","package_pversion","package_platforms","package_outputs","package_default_output","package_programs","package_mainProgram","package_license","package_license_set","package_maintainers","package_maintainers_set","package_teams","package_teams_set","package_description","package_longDescription","package_hydra","package_system","package_homepage","package_position"]);try{let s=await fetch(i,{method:"POST",headers:E,body:JSON.stringify(c)});if(!s.ok)throw new Error(`Search request failed: ${s.status}`);let n=await s.json(),l=new Map;return n.hits.hits.forEach(p=>{let t=p._source,o=null;if(t.flake_resolved){let g=`https://github.com/${t.flake_resolved.owner}/${t.flake_resolved.repo}`;o={name:t.package_attr_name,description:t.flake_description||t.package_description,flakeName:t.flake_name,revision:t.revision,owner:t.flake_resolved.owner,repo:t.flake_resolved.repo,sourceUrl:g,score:p._score,pname:t.package_pname,platforms:t.package_platforms,maintainers:t.package_maintainers_set.join(", "),licenses:t.package_license_set.join(", ")}}else{let g=t.package_homepage?.[0]||`https://github.com/NixOS/nixpkgs/blob/master/${t.package_position?.split(":")[0]||""}`;o={name:t.package_attr_name,description:t.package_description||"Nix package",flakeName:t.package_attr_name,revision:"unknown",owner:"NixOS",repo:"nixpkgs",sourceUrl:g,score:p._score,pname:t.package_pname,platforms:t.package_platforms,maintainers:t.package_maintainers_set.join(", "),licenses:t.package_license_set.join(", ")}}let m=`${o.name}-${o.revision}`;l.has(m)||l.set(m,o)}),Array.from(l.values()).sort((p,t)=>t.score-p.score)}catch(s){throw console.error("Failed to search Nix flake packages:",s),s}}var r=require("@vicinae/api");var C=require("@vicinae/api"),_=require("@vicinae/api");async function k(e,i){try{await C.Clipboard.copy(e),(0,_.showToast)({style:_.Toast.Style.Success,title:"Copied",message:`${i} copied to clipboard`})}catch{(0,_.showToast)({style:_.Toast.Style.Failure,title:"Copy failed",message:`Failed to copy ${i.toLowerCase()}`})}}var a=require("react/jsx-runtime");function R({flakeName:e,repo:i,packageName:c,platforms:s,maintainers:n,licenses:l}){let p=s.length>0,t=n.trim(),o=l.trim();return(0,a.jsxs)(r.List.Item.Detail.Metadata,{children:[(0,a.jsx)(r.List.Item.Detail.Metadata.Label,{title:"Flake",text:e}),(0,a.jsx)(r.List.Item.Detail.Metadata.Separator,{}),(0,a.jsx)(r.List.Item.Detail.Metadata.Label,{title:"Repository",text:i}),(0,a.jsx)(r.List.Item.Detail.Metadata.Separator,{}),(0,a.jsx)(r.List.Item.Detail.Metadata.Label,{title:"Package",text:c}),p&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.List.Item.Detail.Metadata.Separator,{}),(0,a.jsx)(r.List.Item.Detail.Metadata.Label,{title:"Platforms",text:s.join(", ")})]}),t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.List.Item.Detail.Metadata.Separator,{}),(0,a.jsx)(r.List.Item.Detail.Metadata.Label,{title:"Maintainers",text:n})]}),o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.List.Item.Detail.Metadata.Separator,{}),(0,a.jsx)(r.List.Item.Detail.Metadata.Label,{title:"Licenses",text:l})]})]})}function $({flake:e}){return(0,a.jsx)(r.List.Item,{title:e.name,accessories:[{text:`v${e.revision.slice(0,7)}`}],detail:(0,a.jsx)(r.List.Item.Detail,{markdown:`# ${e.name}

${S(e.description)}`,metadata:(0,a.jsx)(R,{flakeName:e.flakeName,repo:`${e.owner}/${e.repo}`,packageName:e.pname,platforms:e.platforms,maintainers:e.maintainers,licenses:e.licenses})}),actions:(0,a.jsxs)(r.ActionPanel,{children:[(0,a.jsx)(r.Action.OpenInBrowser,{title:"Open Repository",icon:r.Icon.Globe,url:e.sourceUrl,shortcut:{modifiers:["ctrl"],key:"o"}}),(0,a.jsx)(r.Action,{title:"Copy Flake Name",icon:r.Icon.Clipboard,onAction:async()=>await k(e.flakeName,"Flake name"),shortcut:{modifiers:["ctrl"],key:"n"}}),(0,a.jsx)(r.Action,{title:"Copy Package Name",icon:r.Icon.Clipboard,onAction:async()=>await k(e.name,"Package name"),shortcut:{modifiers:["ctrl"],key:"p"}}),(0,a.jsx)(r.Action,{title:"Copy Description",icon:r.Icon.Clipboard,onAction:async()=>await k(e.description,"Description"),shortcut:{modifiers:["ctrl"],key:"d"}})]})},`${e.name}-${e.revision}`)}var y=require("@vicinae/api");var d=require("react"),h=require("@vicinae/api");function N(e,i="Search failed"){let[c,s]=(0,d.useState)([]),[n,l]=(0,d.useState)(!1),[p,t]=(0,d.useState)(""),o=(0,d.useRef)(null),m=(0,d.useCallback)(async u=>{if(!u.trim()){s([]);return}l(!0);try{let x=await e(u);s(x)}catch(x){console.error("Search failed:",x),(0,h.showToast)({style:h.Toast.Style.Failure,title:"Search failed",message:i}),s([])}finally{l(!1)}},[e,i]),g=(0,d.useCallback)(u=>{t(u),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{m(u),o.current=null},500)},[m]);return{items:c,isLoading:n,searchText:p,handleSearchTextChange:g}}var f=require("react/jsx-runtime");function M({searchFunction:e,errorMessage:i,placeholder:c,emptyIcon:s,emptyTitle:n,emptyDescription:l,renderItems:p}){let{items:t,isLoading:o,searchText:m,handleSearchTextChange:g}=N(e,i);return(0,f.jsxs)(y.List,{isLoading:o,onSearchTextChange:g,searchBarPlaceholder:c,isShowingDetail:!0,children:[p(t),!o&&m&&t.length===0&&(0,f.jsx)(y.List.EmptyView,{icon:s,title:`No results found for "${m}"`,description:"Try a different search term"}),!o&&!m&&(0,f.jsx)(y.List.EmptyView,{icon:s,title:n,description:l})]})}var w=require("react/jsx-runtime");function O(){return(0,w.jsx)(M,{searchFunction:P,errorMessage:"Failed to search Nix flake packages. Please try again.",placeholder:"Search Nix flake packages...",emptyIcon:L.Icon.Box,emptyTitle:"Search Nix Flake Packages",emptyDescription:"Type in the search bar to find Nix flake packages",renderItems:e=>e.map(i=>(0,w.jsx)($,{flake:i},`${i.name}-${i.revision}`))})}
