"use strict";var M=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var H=Object.prototype.hasOwnProperty;var R=(e,t)=>{for(var s in t)M(e,s,{get:t[s],enumerable:!0})},j=(e,t,s,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of E(t))!H.call(e,o)&&o!==s&&M(e,o,{get:()=>t[o],enumerable:!(n=z(t,o))||n.enumerable});return e};var q=e=>j(M({},"__esModule",{value:!0}),e);var B={};R(B,{default:()=>F});module.exports=q(B);var T=require("@vicinae/api");var P=require("@vicinae/api"),C=(0,P.getPreferenceValues)(),G={"User-Agent":"Mozilla/5.0 (X11; Linux x86_64; rv:138.0) Gecko/20100101 Firefox/138.0",Origin:"https://search.nixos.org/",Accept:"application/json","Content-Type":"application/json",Authorization:`Basic ${C.authToken}`};function V(e,t){return{from:0,size:50,sort:[{_score:"desc",package_attr_name:"desc",package_pversion:"desc"}],aggs:{package_attr_set:{terms:{field:"package_attr_set",size:20}},package_license_set:{terms:{field:"package_license_set",size:20}},package_maintainers_set:{terms:{field:"package_maintainers_set",size:20}},package_teams_set:{terms:{field:"package_teams_set",size:20}},package_platforms:{terms:{field:"package_platforms",size:20}},all:{global:{},aggregations:{package_attr_set:{terms:{field:"package_attr_set",size:20}},package_license_set:{terms:{field:"package_license_set",size:20}},package_maintainers_set:{terms:{field:"package_maintainers_set",size:20}},package_teams_set:{terms:{field:"package_teams_set",size:20}},package_platforms:{terms:{field:"package_platforms",size:20}}}}},query:{bool:{filter:[{term:{type:{value:"package",_name:"filter_packages"}}},{bool:{must:[{bool:{should:[]}},{bool:{should:[]}},{bool:{should:[]}},{bool:{should:[]}},{bool:{should:[]}}]}}],must_not:[],must:[{dis_max:{tie_breaker:.7,queries:[{multi_match:{type:"cross_fields",query:e,analyzer:"whitespace",auto_generate_synonyms_phrase_query:!1,operator:"and",_name:`multi_match_${e}`,fields:["package_attr_name^9","package_attr_name.*^5.3999999999999995","package_programs^9","package_programs.*^5.3999999999999995","package_pname^6","package_pname.*^3.5999999999999996","package_description^1.3","package_description.*^0.78","package_longDescription^1","package_longDescription.*^0.6","flake_name^0.5","flake_name.*^0.3"]}},{wildcard:{package_attr_name:{value:`*${e}*`,case_insensitive:!0}}}]}}]}},_source:t,track_total_hits:!0}}function h(e){return e?e.replace(/<[^>]*>/g,"").replace(/^\n+/,"").replace(/\n+$/,"").trim():""}async function $(e){let t=V(e,["type","package_attr_name","package_attr_set","package_pname","package_pversion","package_platforms","package_outputs","package_default_output","package_programs","package_mainProgram","package_license","package_license_set","package_maintainers","package_maintainers_set","package_teams","package_teams_set","package_description","package_longDescription","package_hydra","package_system","package_homepage","package_position"]);try{let s=await fetch(C.searchUrl,{method:"POST",headers:G,body:JSON.stringify(t)});if(!s.ok)throw new Error(`Search request failed: ${s.status}`);let n=await s.json(),o=new Map;return n.hits.hits.forEach(l=>{let r=l._source,c=r.package_position.split(":"),m=c[c.length-1],d=c.slice(0,-1).join(":"),f=`https://github.com/NixOS/nixpkgs/blob/master/${d.startsWith("/")?d.slice(1):d}#L${m}`,A=r.package_description||"No description available.",U=h(A),I={name:r.package_attr_name,version:r.package_pversion,description:U,homepage:r.package_homepage[0]||"",licenses:r.package_license_set.join(", "),sourceUrl:f,score:l._score,pname:r.package_pname,platforms:r.package_platforms,maintainers:r.package_maintainers_set.join(", "),longDescription:r.package_longDescription?h(r.package_longDescription):null},S=`${I.name}-${I.version}`;o.has(S)||o.set(S,I)}),Array.from(o.values()).sort((l,r)=>r.score-l.score)}catch(s){throw console.error("Failed to search Nix packages:",s),s}}var L=require("child_process"),i=require("@vicinae/api");var N=require("@vicinae/api"),_=require("@vicinae/api");async function w(e,t){try{await N.Clipboard.copy(e),(0,_.showToast)({style:_.Toast.Style.Success,title:"Copied",message:`${t} copied to clipboard`})}catch{(0,_.showToast)({style:_.Toast.Style.Failure,title:"Copy failed",message:`Failed to copy ${t.toLowerCase()}`})}}var a=require("react/jsx-runtime");function J({version:e,platforms:t,maintainers:s,licenses:n}){let o=t.length>0,l=s.trim(),r=n.trim();return(0,a.jsxs)(i.List.Item.Detail.Metadata,{children:[(0,a.jsx)(i.List.Item.Detail.Metadata.Label,{title:"Version",text:e}),o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.List.Item.Detail.Metadata.Separator,{}),(0,a.jsx)(i.List.Item.Detail.Metadata.Label,{title:"Platforms",text:t.join(", ")})]}),l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.List.Item.Detail.Metadata.Separator,{}),(0,a.jsx)(i.List.Item.Detail.Metadata.Label,{title:"Maintainers",text:s})]}),r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.List.Item.Detail.Metadata.Separator,{}),(0,a.jsx)(i.List.Item.Detail.Metadata.Label,{title:"Licenses",text:n})]})]})}function O({pkg:e}){let t=()=>{e.homepage&&(0,L.exec)(`xdg-open "${e.homepage}"`)};return(0,a.jsx)(i.List.Item,{title:e.name,accessories:[{text:`v${e.version}`}],detail:(0,a.jsx)(i.List.Item.Detail,{markdown:`# ${e.name}

${h(e.longDescription||e.description)}`,metadata:(0,a.jsx)(J,{version:e.version,platforms:e.platforms,maintainers:e.maintainers,licenses:e.licenses})}),actions:(0,a.jsxs)(i.ActionPanel,{children:[(0,a.jsx)(i.Action,{title:"Open Homepage",icon:i.Icon.Globe,onAction:t,shortcut:{modifiers:["ctrl"],key:"o"}}),e.sourceUrl&&(0,a.jsx)(i.Action.OpenInBrowser,{title:"View Source Code",icon:i.Icon.Code,url:e.sourceUrl,shortcut:{modifiers:["ctrl"],key:"s"}}),(0,a.jsx)(i.Action,{title:"Copy Package Name",icon:i.Icon.Clipboard,onAction:async()=>await w(e.name,"Package name"),shortcut:{modifiers:["ctrl"],key:"n"}}),(0,a.jsx)(i.Action,{title:"Copy Description",icon:i.Icon.Clipboard,onAction:async()=>await w(e.description,"Description"),shortcut:{modifiers:["ctrl"],key:"d"}})]})},`${e.name}-${e.version}`)}var x=require("@vicinae/api");var p=require("react"),y=require("@vicinae/api");function v(e,t="Search failed"){let[s,n]=(0,p.useState)([]),[o,l]=(0,p.useState)(!1),[r,u]=(0,p.useState)(""),c=(0,p.useRef)(null),m=(0,p.useCallback)(async g=>{if(!g.trim()){n([]);return}l(!0);try{let f=await e(g);n(f)}catch(f){console.error("Search failed:",f),(0,y.showToast)({style:y.Toast.Style.Failure,title:"Search failed",message:t}),n([])}finally{l(!1)}},[e,t]),d=(0,p.useCallback)(g=>{u(g),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{m(g),c.current=null},500)},[m]);return{items:s,isLoading:o,searchText:r,handleSearchTextChange:d}}var k=require("react/jsx-runtime");function D({searchFunction:e,errorMessage:t,placeholder:s,emptyIcon:n,emptyTitle:o,emptyDescription:l,renderItems:r}){let{items:u,isLoading:c,searchText:m,handleSearchTextChange:d}=v(e,t);return(0,k.jsxs)(x.List,{isLoading:c,onSearchTextChange:d,searchBarPlaceholder:s,isShowingDetail:!0,children:[r(u),!c&&m&&u.length===0&&(0,k.jsx)(x.List.EmptyView,{icon:n,title:`No results found for "${m}"`,description:"Try a different search term"}),!c&&!m&&(0,k.jsx)(x.List.EmptyView,{icon:n,title:o,description:l})]})}var b=require("react/jsx-runtime");function F(){return(0,b.jsx)(D,{searchFunction:$,errorMessage:"Failed to search Nix packages. Please try again.",placeholder:"Search Nix packages...",emptyIcon:T.Icon.Box,emptyTitle:"Search Nix Packages",emptyDescription:"Type in the search bar to find Nix packages",renderItems:e=>e.map(t=>(0,b.jsx)(O,{pkg:t},`${t.name}-${t.version}`))})}
